<app-meni></app-meni>
<div class="rezervacije-container">
  <h2>Trenutne rezervacije</h2>
  <table *ngIf="currentReservations.length > 0">
    <thead>
      <tr>
        
        <th>Datum početka</th>
        <th>Datum kraja</th>
        <th>Vikendica</th>
        <th>Mesto</th>
      </tr>
    </thead>
    <tbody>
      @for(r of currentReservations; track r.vikendica+'-'+ r.datumPocetka; let i=$index){
      <tr>
        
        <td data-label="Datum početka">{{r.datumPocetka | date:'dd.MM.yyyy' }}</td>
        <td data-label="Datum kraja">{{r.datumKraja | date:'dd.MM.yyyy'}}</td>
        <td data-label="Vikendica">{{r.vikendica}}</td>
        <td>{{vikendica[i]?.mesto}}</td>
        <td><button (click)="otkazi(r)">Otkaži</button></td>
      </tr>
      }
    </tbody>
  </table>
  <span class="message">{{message}}</span>
  <p *ngIf="currentReservations.length === 0">Nemate trenutnih rezervacija.</p>

  <h2>Arhiva rezervacija</h2>
  <table *ngIf="pastReservations.length > 0">
    <thead>
      <tr>
        <th>Datum početka</th>
        <th>Vikendica</th>
        
        <th>Komentar</th>
        <th>Ocena</th>
      </tr>
    </thead>
    <tbody>
    @for(r of pastReservations; track r.vikendica + '-' + r.datumPocetka){
  <tr>
    
    <td>{{r.datumPocetka | date:'dd.MM.yyyy'}}</td>
    <td>{{r.vikendica}}</td>
    <!--<td>{{r.datumKraja | date:'dd.MM.yyyy'}}</td>-->
    <td>
      <span *ngIf="r.komentar">{{r.komentar}}</span>
      <button *ngIf="!r.komentar" (click)="openCommentForm(r)">Ostavi komentar</button>
    </td>
    <td>{{r.ocena || '-'}}</td>
  </tr>
}

<!-- Forma za unos komentara i ocene -->
<div *ngIf="showCommentForm" class="comment-form">
  <h4>Ostavi komentar i ocenu za {{selectedReservation?.vikendica}}</h4>
  <textarea [(ngModel)]="newComment" maxlength="500" placeholder="Ostavite komentar"></textarea>
  <div class="rating">
    <span *ngFor="let star of [1,2,3,4,5]" (click)="newRating = star">
      <i [class.filled]="newRating >= star">&#9733;</i>
    </span>
  </div>
  <button (click)="submitComment()">Pošalji</button>
  <button (click)="cancelComment()">Otkaži</button>
</div>
