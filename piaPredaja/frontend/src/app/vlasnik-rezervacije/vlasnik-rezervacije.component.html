<app-meni-vlasnik></app-meni-vlasnik>

<div class="container">
  <!-- Kalendar sekcija -->
  <div class="calendar-section">
    <h2>Kalendar rezervacija</h2>
    <div class="calendar-container">
      <full-calendar 
        #calendar
        [options]="calendarOptions">
      </full-calendar>
    </div>
    
    <!-- Legenda -->
    <div class="legend">
      <div class="legend-item">
        <div class="color-box pending"></div>
        <span>Neobrađene rezervacije</span>
      </div>
      <div class="legend-item">
        <div class="color-box accepted"></div>
        <span>Prihvaćene rezervacije</span>
      </div>
    </div>
  </div>

  <!-- Dijalog za akcije -->
  <div *ngIf="showDialog && selectedReservation" class="dialog-overlay">
    <div class="dialog">
      <h3>Upravljanje rezervacijom</h3>
      
      <div class="reservation-details">
        <p><strong>Vikendica:</strong> {{ selectedReservation.vikendica }}</p>
        <p><strong>Gost:</strong> {{ selectedReservation.turista }}</p>
        <p><strong>Od:</strong> {{ selectedReservation.datumPocetka | date: 'dd.MM.yyyy' }}</p>
        <p><strong>Do:</strong> {{ selectedReservation.datumKraja | date: 'dd.MM.yyyy' }}</p>
        <p><strong>Broj osoba:</strong> {{ selectedReservation.brojOsoba }}</p>
        <p><strong>Status:</strong> {{ selectedReservation.status }}</p>
      </div>

      <div class="dialog-actions">
        <button class="prihvati" (click)="prihvatiRezervaciju(selectedReservation!)">
          Prihvati
        </button>
        
        <div class="odbij-section">
          <textarea 
            [(ngModel)]="komentar"
            placeholder="Unesite komentar za odbijanje..."
            rows="3">
          </textarea>
          <button class="odbij" (click)="odbijRezervaciju(selectedReservation!)">
            Odbij
          </button>
        </div>
        
        <button class="zatvori" (click)="closeDialog()">Zatvori</button>
      </div>
    </div>
  </div>

  <!-- Lista neobrađenih rezervacija -->
  <div class="rezervacije-container">
    <h2>Neobrađene rezervacije</h2>

    <div *ngIf="rezervacije.length === 0" class="prazno">
      Trenutno nema neobrađenih rezervacija.
    </div>

    <!-- PROMENA: Dodaj *ngIf na spoljni div da se prikazuje samo ako ima rezervacija na čekanju -->
    <div *ngFor="let r of rezervacije" >
      <div *ngIf="r.status == 'na čekanju'" class="rezervacija-card">
        <h3>{{ r.vikendica }}</h3>
        <p><strong>Gost:</strong> {{ r.turista }}</p>
        <p><strong>Od:</strong> {{ r.datumPocetka | date: 'dd.MM.yyyy' }}</p>
        <p><strong>Do:</strong> {{ r.datumKraja | date: 'dd.MM.yyyy' }}</p>
        <p><strong>Broj osoba:</strong> {{ r.brojOsoba }}</p>

        <div class="akcije">
          <button class="prihvati" (click)="prihvatiRezervaciju(r)">Prihvati</button>

          <div class="odbij-blok">
            <textarea 
              [(ngModel)]="komentar"
              placeholder="Unesite komentar za odbijanje..."
            ></textarea>
            <button class="odbij" (click)="odbijRezervaciju(r)">Odbij</button>
            </div>
        </div>
      </div>
    </div>
  </div>
</div>